import { Injectable } from '@nestjs/common';
import { AuthMicroModuleConfig } from './auth-micro-module.interface';

@Injectable()
export abstract class BaseAuthMicroModule {
  abstract readonly config: AuthMicroModuleConfig;

  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–∫—Ä–æ–º–æ–¥—É–ª—è
   */
  async initialize(): Promise<void> {
    console.log(`üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–∫—Ä–æ–º–æ–¥—É–ª—è: ${this.config.name} v${this.config.version}`);
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   */
  async checkDependencies(): Promise<boolean> {
    if (!this.config.dependencies || this.config.dependencies.length === 0) {
      return true;
    }

    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è ${this.config.name}:`, this.config.dependencies);
    return true;
  }

  /**
   * –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è
   */
  async toggle(enabled: boolean): Promise<void> {
    this.config.enabled = enabled;
    console.log(`üîÑ –ú–∏–∫—Ä–æ–º–æ–¥—É–ª—å ${this.config.name} ${enabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`);
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥—É–ª—è
   */
  getStatus(): { enabled: boolean; healthy: boolean; dependencies: boolean } {
    return {
      enabled: this.config.enabled,
      healthy: true, // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å health check
      dependencies: true, // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    };
  }
}
