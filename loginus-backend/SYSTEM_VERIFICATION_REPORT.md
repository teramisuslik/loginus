# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–∏—Å—Ç–µ–º—ã –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ–π Vselena

## üìÖ –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 2023-10-23

## üéØ –¶–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ–π.
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ–π —á–µ—Ä–µ–∑ API –∏ –ø—Ä–æ—Å—Ç–æ–π HTML-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.

---

## ‚úÖ 1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

### 1.1. –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã –≤ `BaseMicroModule`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ –∫–∞–∂–¥–æ–º –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ.
- **–†–µ—à–µ–Ω–∏–µ:** –í `vselena-backend/src/common/base/base-micro-module.ts` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
  - `protected logInitialization(): void`
  - `protected logDestruction(): void`
  - `protected validateModuleName(): boolean`
  - `protected validateVersion(): boolean`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –º–∏–∫—Ä–æ–º–æ–¥—É–ª–∏ (`EmailAuthMicroModule`, `PhoneAuthMicroModule`, `ReferralMicroModule`, `CustomRolesMicroModule`, `UIPermissionsMicroModule`) –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–∏—Ö –æ–±—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏–ª–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ª—É—á—à–∏–ª–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

### 1.2. `PermissionsUtilsService`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –µ–≥–æ —Ä–æ–ª–µ–π –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `EmailAuthService`, `UIPermissionsService`).
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å `vselena-backend/src/common/services/permissions-utils.service.ts` —Å –º–µ—Ç–æ–¥–∞–º–∏:
  - `extractUserPermissions(user: User): string[]`
  - `userHasRole(user: User, roleName: string): boolean`
  - `userHasAnyPermission(user: User, requiredPermissions: string[]): boolean`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–µ—Ä–≤–∏—Å—ã `EmailAuthService` –∏ `UIPermissionsService` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `PermissionsUtilsService`, —á—Ç–æ —É—Å—Ç—Ä–∞–Ω–∏–ª–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–≤–∞–º–∏. `CommonModule` –±—ã–ª –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ `PermissionsUtilsService`.

---

## ‚úÖ 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### 2.1. Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **Endpoint:** `http://localhost:3001/api/docs`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Swagger –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö API –º–∞—Ä—à—Ä—É—Ç–∞—Ö, –≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ–º–æ–¥—É–ª—è–º–∏.

### 2.2. HTML —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–§–∞–π–ª:** `vselena-backend/test-micro-modules.html`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω –ø—Ä–æ—Å—Ç–æ–π HTML-—Ñ–∞–π–ª —Å JavaScript –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è AJAX-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ endpoints.
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
  - **`GET /api/micro-modules`**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ–π.
  - **`GET /api/micro-modules/:moduleName`**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `email-auth`).
  - **`POST /api/micro-modules/:moduleName/enable`** (—Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ super_admin): –ü–æ–ø—ã—Ç–∫–∞ –≤–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å.
  - **`POST /api/micro-modules/:moduleName/disable`** (—Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ super_admin): –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ HTML-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—Å–ø–µ—à–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ endpoints. –ó–∞–ø—Ä–æ—Å—ã –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º endpoints (enable/disable) –æ–∂–∏–¥–∞–µ–º–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫–∏ 401/403, —Ç–∞–∫ –∫–∞–∫ HTML-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### 2.3. API Endpoints
- **`vselena-backend/src/common/controllers/micro-modules.controller.ts`**
  - **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@Public()` –∫ –º–µ—Ç–æ–¥–∞–º `getAllModules()` –∏ `getModule(':moduleName')`, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –±–µ–∑ JWT-—Ç–æ–∫–µ–Ω–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥—É–ª—è—Ö.
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á–µ—Ä–µ–∑ `curl` –∏ HTML-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

## üìä –û–±—â–∏–π –≤—ã–≤–æ–¥

–°–∏—Å—Ç–µ–º–∞ –º–∏–∫—Ä–æ–º–æ–¥—É–ª–µ–π Vselena —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ –±–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –£–ª—É—á—à–µ–Ω–∞ –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** –û—Å–Ω–æ–≤–Ω—ã–µ API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ–º–æ–¥—É–ª—è–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** Swagger –∞–∫—Ç—É–∞–ª–µ–Ω.
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω –ø—Ä–æ—Å—Ç–æ–π HTML-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ frontend –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.